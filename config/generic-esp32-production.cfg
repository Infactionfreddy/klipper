# Production-ready configuration for ESP32 (original)
# Xtensa dual-core @ 240MHz
# Flash: 4MB | RAM: 520KB | GPIO: 0-39 (34-39 input-only)
# Features: WiFi, Bluetooth, 2x DAC, Touch sensors

[mcu]
serial: /dev/ttyUSB0
baud: 250000
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 15
max_z_accel: 100

# ========================================
# STEPPER CONFIGURATION
# ========================================
[stepper_x]
step_pin: GPIO2
dir_pin: GPIO4
enable_pin: !GPIO5
microsteps: 16
rotation_distance: 40
endstop_pin: ^GPIO15
position_endstop: 0
position_max: 220
homing_speed: 50

[stepper_y]
step_pin: GPIO16
dir_pin: GPIO17
enable_pin: !GPIO18
microsteps: 16
rotation_distance: 40
endstop_pin: ^GPIO14
position_endstop: 0
position_max: 220
homing_speed: 50

[stepper_z]
step_pin: GPIO19
dir_pin: !GPIO21
enable_pin: !GPIO22
microsteps: 16
rotation_distance: 8
endstop_pin: ^GPIO27
position_endstop: 0.5
position_max: 250
position_min: -2

[extruder]
step_pin: GPIO12
dir_pin: GPIO13
enable_pin: !GPIO14
microsteps: 16
rotation_distance: 33.500
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: GPIO23
sensor_type: EPCOS 100K B57560G104F
sensor_pin: GPIO36  # ADC1_CH0
control: pid
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114
min_temp: 0
max_temp: 265
min_extrude_temp: 170
max_extrude_only_distance: 150.0

# ========================================
# HEATED BED
# ========================================
[heater_bed]
heater_pin: GPIO25
sensor_type: EPCOS 100K B57560G104F
sensor_pin: GPIO39  # ADC1_CH3 (input-only)
control: pid
pid_Kp: 54.027
pid_Ki: 0.770
pid_Kd: 948.182
min_temp: 0
max_temp: 130

# ========================================
# FANS (PWM via LEDC)
# ========================================
[fan]
pin: GPIO26
max_power: 1.0
kick_start_time: 0.5
off_below: 0.1

[heater_fan hotend_fan]
pin: GPIO32
max_power: 1.0
heater: extruder
heater_temp: 50.0
fan_speed: 1.0

# ========================================
# OPTIONAL: DAC OUTPUT (ESP32 only!)
# ESP32 has 2x 8-bit DAC on GPIO25/GPIO26
# ========================================
# Example for analog motor control or LED dimming
#[output_pin dac_output_1]
#pin: GPIO25
#pwm: False
#value: 0.5  # 0-1.0 = 0-3.3V
#
#[output_pin dac_output_2]
#pin: GPIO26
#pwm: False
#value: 0.0

# ========================================
# BED LEVELING (Optional)
# ========================================
[bltouch]
sensor_pin: ^GPIO34  # Input-only pin
control_pin: GPIO33
x_offset: -44
y_offset: -6
z_offset: 2.3
speed: 5
samples: 2
sample_retract_dist: 3.0

[safe_z_home]
home_xy_position: 154, 116
speed: 50
z_hop: 10
z_hop_speed: 5

[bed_mesh]
speed: 120
horizontal_move_z: 5
mesh_min: 15, 15
mesh_max: 175, 195
probe_count: 5, 5
algorithm: bicubic

# ========================================
# SAFETY FEATURES
# ========================================
[verify_heater extruder]
max_error: 120
check_gain_time: 20
hysteresis: 5
heating_gain: 2

[verify_heater heater_bed]
max_error: 120
check_gain_time: 60
hysteresis: 5
heating_gain: 2

# ========================================
# DISPLAY (Optional)
# ========================================
# I2C LCD on GPIO21/GPIO22 (default I2C pins)
#[display]
#lcd_type: hd44780
#rs_pin: GPIO21
#e_pin: GPIO22
#d4_pin: GPIO19
#d5_pin: GPIO18
#d6_pin: GPIO5
#d7_pin: GPIO17

# ========================================
# GPIO NOTES FOR ESP32
# ========================================
# Safe output pins: GPIO2, 4, 5, 12-19, 21-23, 25-27, 32-33
# Safe input pins: GPIO34-39 (input-only, no pullup)
# Strapping pins (avoid): GPIO0, 2, 5, 12, 15
# Flash reserved: GPIO6-11 (DO NOT USE)
# ADC1 pins: GPIO32-39 (recommended for analog sensors)
# ADC2 pins: GPIO0, 2, 4, 12-15, 25-27 (unusable with WiFi!)
# DAC pins: GPIO25, GPIO26 (8-bit 0-3.3V)
# Touch sensors: GPIO0, 2, 4, 12-15, 27, 32-33
