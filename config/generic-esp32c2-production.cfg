# Production-ready configuration for ESP32-C2
# RISC-V single-core @ 120MHz (lower performance!)
# Flash: 2-4MB | RAM: 272KB | GPIO: 0-20 (LIMITED!)
# Features: WiFi, Bluetooth LE
# NO DAC, NO Touch sensors - use PWM for analog

[mcu]
serial: /dev/ttyUSB0  # UART only (no native USB)
baud: 250000
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 250  # Reduced due to 120MHz CPU
max_accel: 2500
max_z_velocity: 12
max_z_accel: 80

# ========================================
# STEPPER CONFIGURATION
# Note: Limited to 21 GPIOs (0-20)!
# ========================================
[stepper_x]
step_pin: GPIO2
dir_pin: GPIO3
enable_pin: !GPIO4
microsteps: 16
rotation_distance: 40
endstop_pin: ^GPIO5
position_endstop: 0
position_max: 220
homing_speed: 40  # Slower due to CPU

[stepper_y]
step_pin: GPIO6
dir_pin: GPIO7
enable_pin: !GPIO8
microsteps: 16
rotation_distance: 40
endstop_pin: ^GPIO9
position_endstop: 0
position_max: 220
homing_speed: 40

[stepper_z]
step_pin: GPIO10
dir_pin: !GPIO11
enable_pin: !GPIO12
microsteps: 16
rotation_distance: 8
endstop_pin: ^GPIO13
position_endstop: 0.5
position_max: 250
position_min: -2

[extruder]
step_pin: GPIO14
dir_pin: GPIO15
enable_pin: !GPIO16
microsteps: 16
rotation_distance: 33.500
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: GPIO1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: GPIO0  # ADC1_CH0
control: pid
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114
min_temp: 0
max_temp: 265
min_extrude_temp: 170
max_extrude_only_distance: 150.0

# ========================================
# HEATED BED
# ========================================
[heater_bed]
heater_pin: GPIO17
sensor_type: EPCOS 100K B57560G104F
sensor_pin: GPIO1  # ADC1_CH1
control: pid
pid_Kp: 54.027
pid_Ki: 0.770
pid_Kd: 948.182
min_temp: 0
max_temp: 130

# ========================================
# FANS (PWM via LEDC)
# ========================================
[fan]
pin: GPIO18
max_power: 1.0
kick_start_time: 0.5
off_below: 0.1

[heater_fan hotend_fan]
pin: GPIO19
max_power: 1.0
heater: extruder
heater_temp: 50.0
fan_speed: 1.0

# ========================================
# PWM DAC EMULATION (ESP32-C2 has NO DAC!)
# Use high-frequency PWM for analog output
# Only 21 GPIOs - use wisely!
# ========================================
[output_pin pwm_dac_1]
pin: GPIO20
pwm: True
hardware_pwm: True
cycle_time: 0.000100  # 10kHz PWM
value: 0.5  # 0-1.0 simulates 0-3.3V

# Note: GPIO20 is last available pin!
# For second DAC, sacrifice another feature

# ========================================
# BED LEVELING - SIMPLIFIED (limited pins!)
# ========================================
# WARNING: ESP32-C2 has only 21 GPIOs!
# BLTouch needs 2 pins - consider manual leveling
#[bltouch]
#sensor_pin: ^GPIO5  # Share with endstop?
#control_pin: GPIO20
#x_offset: -44
#y_offset: -6
#z_offset: 2.3

[bed_screws]
screw1: 30, 30
screw2: 200, 30
screw3: 200, 200
screw4: 30, 200

# ========================================
# SAFETY FEATURES
# ========================================
[verify_heater extruder]
max_error: 120
check_gain_time: 25  # Slower CPU needs more time
hysteresis: 5
heating_gain: 2

[verify_heater heater_bed]
max_error: 120
check_gain_time: 70
hysteresis: 5
heating_gain: 2

# ========================================
# GPIO NOTES FOR ESP32-C2
# ========================================
# CRITICAL: Only GPIO0-GPIO20 available (21 pins total!)
# Safe output pins: GPIO0-20
# Strapping pins (avoid): GPIO2, 8, 9
# ADC pins: GPIO0-4 (5 channels only)
# NO DAC hardware - must use PWM emulation
# NO Touch sensors
# UART: GPIO20 (TX), GPIO19 (RX) - default console
# 
# PIN BUDGET WARNING:
# - Steppers: 12 pins (4 motors Ã— 3 pins)
# - Heaters: 2 pins
# - Thermistors: 2 pins (ADC)
# - Fans: 2 pins
# - Endstops: 3 pins
# = 21 pins FULLY USED! No room for extras!
#
# RECOMMENDATION: Use ESP32-C3/C6 for production
# ESP32-C2 is too limited for complex setups!
