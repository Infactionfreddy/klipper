# Production-ready configuration for ESP32-C3
# RISC-V single-core @ 160MHz
# Flash: 4MB | RAM: 400KB | GPIO: 0-21 (22 pins)
# Features: WiFi, Bluetooth LE, USB OTG
# NO DAC, NO Touch sensors - use PWM for analog

[mcu]
serial: /dev/ttyACM0  # USB CDC (native USB)
# Alternative UART: /dev/ttyUSB0
baud: 250000
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 15
max_z_accel: 100

# ========================================
# STEPPER CONFIGURATION
# Note: Limited to 22 GPIOs (0-21)!
# ========================================
[stepper_x]
step_pin: GPIO2
dir_pin: GPIO3
enable_pin: !GPIO4
microsteps: 16
rotation_distance: 40
endstop_pin: ^GPIO5
position_endstop: 0
position_max: 220
homing_speed: 50

[stepper_y]
step_pin: GPIO6
dir_pin: GPIO7
enable_pin: !GPIO8
microsteps: 16
rotation_distance: 40
endstop_pin: ^GPIO9
position_endstop: 0
position_max: 220
homing_speed: 50

[stepper_z]
step_pin: GPIO10
dir_pin: !GPIO11
enable_pin: !GPIO12
microsteps: 16
rotation_distance: 8
endstop_pin: ^GPIO13
position_endstop: 0.5
position_max: 250
position_min: -2

[extruder]
step_pin: GPIO14
dir_pin: GPIO15
enable_pin: !GPIO16
microsteps: 16
rotation_distance: 33.500
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: GPIO1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: GPIO0  # ADC1_CH0
control: pid
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114
min_temp: 0
max_temp: 265
min_extrude_temp: 170
max_extrude_only_distance: 150.0

# ========================================
# HEATED BED
# ========================================
[heater_bed]
heater_pin: GPIO17
sensor_type: EPCOS 100K B57560G104F
sensor_pin: GPIO1  # ADC1_CH1
control: pid
pid_Kp: 54.027
pid_Ki: 0.770
pid_Kd: 948.182
min_temp: 0
max_temp: 130

# ========================================
# FANS (PWM via LEDC)
# ========================================
[fan]
pin: GPIO21
max_power: 1.0
kick_start_time: 0.5
off_below: 0.1

# Note: Running out of pins! Share carefully
#[heater_fan hotend_fan]
#pin: GPIO20
#max_power: 1.0
#heater: extruder
#heater_temp: 50.0

# ========================================
# PWM DAC EMULATION (ESP32-C3 has NO DAC!)
# Use high-frequency PWM for analog output
# ========================================
[output_pin pwm_dac_1]
pin: GPIO20
pwm: True
hardware_pwm: True
cycle_time: 0.000100  # 10kHz PWM
value: 0.5  # 0-1.0 simulates 0-3.3V

# Second DAC requires sacrificing another pin
#[output_pin pwm_dac_2]
#pin: GPIO4  # Re-purpose if needed
#pwm: True
#hardware_pwm: True
#cycle_time: 0.000100
#value: 0.0

# ========================================
# BED LEVELING (Optional)
# WARNING: Limited pins! Manual leveling recommended
# ========================================
[bed_screws]
screw1: 30, 30
screw2: 200, 30
screw3: 200, 200
screw4: 30, 200

# BLTouch alternative (needs 2 pins):
#[bltouch]
#sensor_pin: ^GPIO5  # Share with X endstop?
#control_pin: GPIO13  # Share with Z endstop?
#x_offset: -44
#y_offset: -6
#z_offset: 2.3

# ========================================
# SAFETY FEATURES
# ========================================
[verify_heater extruder]
max_error: 120
check_gain_time: 20
hysteresis: 5
heating_gain: 2

[verify_heater heater_bed]
max_error: 120
check_gain_time: 60
hysteresis: 5
heating_gain: 2

# ========================================
# OPTIONAL: NEOPIXEL SUPPORT
# ESP32-C3 has hardware RMT for WS2812
# ========================================
#[neopixel chamber_lights]
#pin: GPIO4
#chain_count: 10
#color_order: GRB
#initial_RED: 0.5
#initial_GREEN: 0.5
#initial_BLUE: 0.5

# ========================================
# GPIO NOTES FOR ESP32-C3
# ========================================
# Available: GPIO0-GPIO21 (22 pins total)
# USB pins: GPIO18 (D-), GPIO19 (D+) - use for CDC
# UART pins: GPIO20 (RXD), GPIO21 (TXD) - console
# Strapping pins: GPIO2, 8, 9 (boot mode selection)
# ADC channels: GPIO0-4 (ADC1, 5 channels)
# NO DAC hardware - use PWM emulation at 10kHz+
# NO Touch sensors
# RMT: All pins (for WS2812/NeoPixel)
#
# PIN ALLOCATION EXAMPLE:
# Steppers: GPIO2-4, 6-8, 10-12, 14-16 (12 pins)
# Heaters: GPIO1, 17 (2 pins)
# Sensors: GPIO0, 1 (2 ADC pins)
# Fans: GPIO21, (20) (1-2 pins)
# Endstops: GPIO5, 9, 13 (3 pins)
# DAC/Extra: GPIO20 (1 pin)
# = 21 pins used (1 spare: GPIO18 or 19 if not using USB)
#
# CRITICAL: USB CDC uses GPIO18/19 internally
# For UART mode, can reclaim these pins!
