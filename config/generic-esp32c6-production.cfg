# Production-ready configuration for ESP32-C6
# RISC-V single-core @ 160MHz
# Flash: 4MB+ | RAM: 512KB | GPIO: 0-30 (31 pins - BEST RISC-V!)
# Features: WiFi 6 (802.11ax), Bluetooth LE 5.3, Zigbee/Thread, USB OTG
# NO DAC, NO Touch sensors - use PWM for analog

[mcu]
serial: /dev/ttyACM0  # USB CDC (native USB)
# Alternative UART: /dev/ttyUSB0
baud: 250000
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 15
max_z_accel: 100

# ========================================
# STEPPER CONFIGURATION
# ESP32-C6 has 31 GPIOs (0-30) - plenty of room!
# ========================================
[stepper_x]
step_pin: GPIO2
dir_pin: GPIO3
enable_pin: !GPIO4
microsteps: 16
rotation_distance: 40
endstop_pin: ^GPIO5
position_endstop: 0
position_max: 220
homing_speed: 50

[stepper_y]
step_pin: GPIO6
dir_pin: GPIO7
enable_pin: !GPIO8
microsteps: 16
rotation_distance: 40
endstop_pin: ^GPIO9
position_endstop: 0
position_max: 220
homing_speed: 50

[stepper_z]
step_pin: GPIO10
dir_pin: !GPIO11
enable_pin: !GPIO12
microsteps: 16
rotation_distance: 8
endstop_pin: ^GPIO13
position_endstop: 0.5
position_max: 250
position_min: -2

[extruder]
step_pin: GPIO14
dir_pin: GPIO15
enable_pin: !GPIO16
microsteps: 16
rotation_distance: 33.500
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: GPIO1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: GPIO0  # ADC1_CH0
control: pid
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114
min_temp: 0
max_temp: 265
min_extrude_temp: 170
max_extrude_only_distance: 150.0

# ========================================
# HEATED BED
# ========================================
[heater_bed]
heater_pin: GPIO21
sensor_type: EPCOS 100K B57560G104F
sensor_pin: GPIO1  # ADC1_CH1
control: pid
pid_Kp: 54.027
pid_Ki: 0.770
pid_Kd: 948.182
min_temp: 0
max_temp: 130

# ========================================
# FANS (PWM via LEDC)
# ========================================
[fan]
pin: GPIO22
max_power: 1.0
kick_start_time: 0.5
off_below: 0.1

[heater_fan hotend_fan]
pin: GPIO23
max_power: 1.0
heater: extruder
heater_temp: 50.0
fan_speed: 1.0

[controller_fan mcu_fan]
pin: GPIO20
max_power: 0.8
idle_speed: 0.3
heater: extruder,heater_bed

# ========================================
# PWM DAC EMULATION (ESP32-C6 has NO DAC!)
# Use high-frequency PWM for analog output
# ========================================
[output_pin pwm_dac_1]
pin: GPIO17
pwm: True
hardware_pwm: True
cycle_time: 0.000100  # 10kHz PWM
value: 0.5  # 0-1.0 simulates 0-3.3V

[output_pin pwm_dac_2]
pin: GPIO18
pwm: True
hardware_pwm: True
cycle_time: 0.000100
value: 0.0

# ========================================
# BED LEVELING (Full featured!)
# ========================================
[bltouch]
sensor_pin: ^GPIO24
control_pin: GPIO25
x_offset: -44
y_offset: -6
z_offset: 2.3
speed: 5
samples: 2
sample_retract_dist: 3.0
probe_with_touch_mode: True
stow_on_each_sample: False

[safe_z_home]
home_xy_position: 154, 116
speed: 50
z_hop: 10
z_hop_speed: 5

[bed_mesh]
speed: 120
horizontal_move_z: 5
mesh_min: 15, 15
mesh_max: 175, 195
probe_count: 5, 5
algorithm: bicubic
fade_start: 1
fade_end: 10

# ========================================
# SAFETY FEATURES
# ========================================
[verify_heater extruder]
max_error: 120
check_gain_time: 20
hysteresis: 5
heating_gain: 2

[verify_heater heater_bed]
max_error: 120
check_gain_time: 60
hysteresis: 5
heating_gain: 2

# ========================================
# FILAMENT SENSOR (Optional)
# ESP32-C6 has enough pins!
# ========================================
[filament_switch_sensor filament_sensor]
switch_pin: ^GPIO26
pause_on_runout: True
runout_gcode:
  M117 Filament runout!
  M600
insert_gcode:
  M117 Filament inserted

# ========================================
# NEOPIXEL LIGHTING (RMT support)
# ========================================
[neopixel chamber_lights]
pin: GPIO27
chain_count: 20
color_order: GRB
initial_RED: 0.5
initial_GREEN: 0.5
initial_BLUE: 0.5

# ========================================
# DISPLAY (Optional - I2C)
# ========================================
# I2C LCD on GPIO28(SDA)/GPIO29(SCL)
#[display]
#lcd_type: hd44780
#i2c_mcu: mcu
#i2c_bus: i2c0a
#i2c_address: 39  # 0x27

# ========================================
# TEMPERATURE SENSORS (Extra monitoring)
# ========================================
[temperature_sensor mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 80

[temperature_sensor chamber_temp]
sensor_type: EPCOS 100K B57560G104F
sensor_pin: GPIO2  # ADC1_CH2
min_temp: 0
max_temp: 70

# ========================================
# GPIO NOTES FOR ESP32-C6
# ========================================
# Available: GPIO0-GPIO30 (31 pins - MOST for RISC-V!)
# USB pins: GPIO12 (D-), GPIO13 (D+) - internal USB PHY
# UART pins: GPIO16 (RXD), GPIO17 (TXD) - default console
# Strapping pins: GPIO4, 5, 15 (boot mode)
# ADC channels: GPIO0-6 (ADC1, 7 channels - BEST ADC!)
# NO DAC hardware - use PWM emulation
# NO Touch sensors
# RMT: All pins (for WS2812/NeoPixel)
# I2C: Any GPIO (software/hardware)
# SPI: Any GPIO (flexible IOMUX)
#
# PIN ALLOCATION PRODUCTION:
# Steppers: GPIO2-4, 6-8, 10-12, 14-16 (12 pins)
# Heaters: GPIO1, 21 (2 pins)
# Sensors: GPIO0-2 (3 ADC pins)
# Fans: GPIO20, 22-23 (3 pins)
# Endstops: GPIO5, 9, 13 (3 pins)
# BLTouch: GPIO24-25 (2 pins)
# DAC/PWM: GPIO17-18 (2 pins)
# Filament: GPIO26 (1 pin)
# NeoPixel: GPIO27 (1 pin)
# I2C Display: GPIO28-29 (2 pins)
# = 31 pins FULLY UTILIZED!
#
# WiFi 6 BENEFITS:
# - Better range and penetration
# - Lower latency for OctoPrint/Moonraker
# - Better multi-device handling
# - Target Wake Time (TWT) for power saving
#
# RECOMMENDATION: ESP32-C6 is BEST choice for:
# - Production systems needing reliability
# - Multi-sensor setups (7 ADC channels!)
# - Modern WiFi infrastructure (WiFi 6)
# - Future Zigbee/Thread integration
